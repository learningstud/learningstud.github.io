<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="description" content="五子棋" />
    <meta name="author" content="Gordon" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>五子棋</title>
    
    <style type="text/css">
        body
        {
            margin: 0;
        }
        #con
        {
            width: 500px;
            height: 500px;
            margin: auto;
            margin-top: 50px;
        }
        #board
        {
            width: 500px;
            height: 500px;
            display: block;
            background-color: burlywood;
        }
        line
        {
            stroke: #777;
            stroke-width: 2px;
        }
        .grid-circle
        {
            stroke: none;
            fill: #777;
        }
    </style>
</head>
<body>
    <div id="con">
        <svg id="board">
            <line x1="25" y1="25" x2="25" y2="475"></line>
            <line x1="25" y1="25" x2="475" y2="25"></line>
            <line x1="50" y1="25" x2="50" y2="475"></line>
            <line x1="25" y1="50" x2="475" y2="50"></line>
            <line x1="75" y1="25" x2="75" y2="475"></line>
            <line x1="25" y1="75" x2="475" y2="75"></line>
            <line x1="100" y1="25" x2="100" y2="475"></line>
            <line x1="25" y1="100" x2="475" y2="100"></line>
            <line x1="125" y1="25" x2="125" y2="475"></line>
            <line x1="25" y1="125" x2="475" y2="125"></line>
            <line x1="150" y1="25" x2="150" y2="475"></line>
            <line x1="25" y1="150" x2="475" y2="150"></line>
            <line x1="175" y1="25" x2="175" y2="475"></line>
            <line x1="25" y1="175" x2="475" y2="175"></line>
            <line x1="200" y1="25" x2="200" y2="475"></line>
            <line x1="25" y1="200" x2="475" y2="200"></line>
            <line x1="225" y1="25" x2="225" y2="475"></line>
            <line x1="25" y1="225" x2="475" y2="225"></line>
            <line x1="250" y1="25" x2="250" y2="475"></line>
            <line x1="25" y1="250" x2="475" y2="250"></line>
            <line x1="275" y1="25" x2="275" y2="475"></line>
            <line x1="25" y1="275" x2="475" y2="275"></line>
            <line x1="300" y1="25" x2="300" y2="475"></line>
            <line x1="25" y1="300" x2="475" y2="300"></line>
            <line x1="325" y1="25" x2="325" y2="475"></line>
            <line x1="25" y1="325" x2="475" y2="325"></line>
            <line x1="350" y1="25" x2="350" y2="475"></line>
            <line x1="25" y1="350" x2="475" y2="350"></line>
            <line x1="375" y1="25" x2="375" y2="475"></line>
            <line x1="25" y1="375" x2="475" y2="375"></line>
            <line x1="400" y1="25" x2="400" y2="475"></line>
            <line x1="25" y1="400" x2="475" y2="400"></line>
            <line x1="425" y1="25" x2="425" y2="475"></line>
            <line x1="25" y1="425" x2="475" y2="425"></line>
            <line x1="450" y1="25" x2="450" y2="475"></line>
            <line x1="25" y1="450" x2="475" y2="450"></line>
            <line x1="475" y1="25" x2="475" y2="475"></line>
            <line x1="25" y1="475" x2="475" y2="475"></line>
            <circle class="grid-circle" cx="100" cy="100" r="4"></circle>
            <circle class="grid-circle" cx="100" cy="250" r="4"></circle>
            <circle class="grid-circle" cx="100" cy="400" r="4"></circle>
            <circle class="grid-circle" cx="250" cy="100" r="4"></circle>
            <circle class="grid-circle" cx="250" cy="250" r="4"></circle>
            <circle class="grid-circle" cx="250" cy="400" r="4"></circle>
            <circle class="grid-circle" cx="400" cy="100" r="4"></circle>
            <circle class="grid-circle" cx="400" cy="250" r="4"></circle>
            <circle class="grid-circle" cx="400" cy="400" r="4"></circle>
        </svg>
    </div>
    
    <button id="remove-button">悔棋</button>
    <input id="gamer-name" type="text" />
    <button id="submit-name">確定送出</button>
    
    <script type="text/javascript">
        
        var ns = "http://www.w3.org/2000/svg";
        var moveHistory = new Array();
        var isPiece = new Array(20);
        var prevPiece = document.createElementNS(ns, "circle");
        var prevActive = null;
        var pieceColor = "#000";
        var worker;
        
        for(var c1 = 0; c1 < 20; c1++)
        {
            isPiece[c1] = new Array(20);
            
            for(var c2 = 0; c2 < 20; c2++)
            {
                isPiece[c1][c2] = false;
            }
        }
        
        function isValid(x, y)
        {
            if(x < 1 || x > 19 || y < 1 || y > 19)
                return false;
            else if(isPiece[x][y])
                return false;
            else
                return true;
        }
        
        function placePiece(x, y)
        {
            var piece = document.createElementNS(ns, "circle");
            var len = moveHistory.push([piece, x, y]);
            
            if(prevActive != null)
            {
                document.getElementById("board").removeChild(prevActive);
                prevActive = null;
            }
            
            piece.setAttribute("cx", x*25);
            piece.setAttribute("cy", y*25);
            piece.setAttribute("r", 11);
            piece.setAttribute("stroke", "#4dd8ea");
            piece.setAttribute("stroke-width", "2");
            piece.setAttribute("fill", pieceColor);
            document.getElementById("board").appendChild(piece);
            
            prevPiece.setAttribute("stroke", "none");
            prevPiece = piece;
            isPiece[x][y] = true;
            
            if(len % 2 == 1)
                pieceColor = "#fff";
            else
                pieceColor = "#000";
        }
        
        function removePiece()
        {
            var len = moveHistory.length;
            var move;
            
            if(len == 0)
            {
                pieceColor = "#000";
                return;
            }
            
            if(prevActive != null)
            {
                document.getElementById("board").removeChild(prevActive);
                prevActive = null;
            }
            
            move = moveHistory.pop();
            document.getElementById("board").removeChild(move[0]);
            isPiece[move[1]][move[2]] = false;
            len--;
            
            prevPiece = moveHistory[len-1][0];
            prevPiece.setAttribute("stroke", "#4dd8ea");
            prevPiece.setAttribute("stroke-width", "2");
            
            if(len % 2 == 1)
                pieceColor = "#fff";
            else
                pieceColor = "#000";
        }
        
        function placeActive(x, y)
        {
            prevActive = document.createElementNS(ns, "rect");
            prevActive.setAttribute("x", x*25-12);
            prevActive.setAttribute("y", y*25-12);
            prevActive.setAttribute("width", 24);
            prevActive.setAttribute("height", 24);
            prevActive.setAttribute("fill", "none");
            prevActive.setAttribute("stroke", "#32e639");
            prevActive.setAttribute("stroke-width", 1);
            document.getElementById("board").appendChild(prevActive);
        }
        
        document.getElementById("board").onclick = function(e)
        {
            var board = document.getElementById("con");
            var x = Math.floor((e.clientX+12.5-board.offsetLeft)/25);
            var y = Math.floor((e.clientY+12.5-board.offsetTop)/25);
            
            if(prevActive != null)
                document.getElementById("board").removeChild(prevActive);
            
            if(isValid(x, y))
                placeActive(x, y);
        };
        
        document.getElementById("board").ondblclick = function(e)
        {
            var board = document.getElementById("con");
            var x = Math.floor((e.clientX+12.5-board.offsetLeft)/25);
            var y = Math.floor((e.clientY+12.5-board.offsetTop)/25);
            
            if(isValid(x, y))
                placePiece(x, y);
        };
        
        document.getElementById("remove-button").onclick = removePiece;
        
        /*document.getElementById("submit-name").onclick = function(e)
        {
            var gamerName = document.getElementById("gamer-name").nodeValue;
            
            worker = new SharedWorker("com.js", gamerName);
            worker.onmessage = function(e)
            {
                
            };
            
        };*/
    </script>
</body>
</html>